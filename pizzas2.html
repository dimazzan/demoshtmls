<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <!-- Fix for iPhone Notch and Zoom -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Пицца на дровах.</title>
    <style>
        :root {
            --bg-color: #0e0e0e;
            --text-color: #ffffff;
            --accent-color: #ff4d00; /* Огненный оранжевый */
            --glass-bg: rgba(20, 20, 20, 0.85);
            --border-color: #333;
            --font-main: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* Scroll Lock Class */
        body.no-scroll { overflow: hidden; }

        /* HEADER */
        header {
            position: fixed;
            top: 0; left: 0; right: 0;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
            /* Notch Fix */
            padding-top: var(--safe-top); 
            height: calc(60px + var(--safe-top));
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-left: 20px;
            padding-right: 20px;
        }

        .logo { font-weight: 900; font-size: 1.2rem; letter-spacing: -0.5px; text-transform: uppercase; }

        /* CART BUTTON IN HEADER */
        .cart-trigger {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 0.9rem;
            position: relative;
        }

        .cart-icon-wrap { position: relative; width: 24px; height: 24px; }
        .cart-icon-svg { width: 100%; height: 100%; fill: white; }
        
        .cart-badge {
            position: absolute;
            top: -8px; right: -8px;
            background: var(--accent-color);
            color: white;
            font-size: 10px;
            font-weight: bold;
            height: 16px;
            min-width: 16px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .cart-badge.active { opacity: 1; transform: scale(1); }

        /* Mobile text hide */
        @media (max-width: 768px) {
            .cart-text { display: none; }
        }

        /* HERO SECTION */
        .hero {
            margin-top: calc(60px + var(--safe-top));
            padding: 60px 20px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }
        .hero h1 { font-size: 2.5rem; line-height: 1.1; margin-bottom: 10px; }
        .hero span { color: #888; font-size: 1.2rem; display: block; margin-bottom: 20px; }
        .hero p { max-width: 600px; margin: 0 auto; color: #aaa; font-size: 0.95rem; }

        /* CATEGORIES */
        .categories-wrapper {
            position: sticky;
            top: calc(59px + var(--safe-top));
            z-index: 90;
            background: var(--bg-color);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .categories-list {
            display: flex;
            gap: 10px;
            padding: 0 20px;
            min-width: max-content;
        }
        .cat-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: #fff;
            padding: 8px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            transition: 0.2s;
            cursor: pointer;
        }
        .cat-btn.active, .cat-btn:hover { background: #fff; color: #000; border-color: #fff; }

        /* GRID */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1px;
            background: var(--border-color); /* Lines between items */
            padding-bottom: 1px;
        }
        .card {
            background: var(--bg-color);
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }
        .card h3 { margin-bottom: 10px; font-size: 1.4rem; }
        .card p { color: #888; font-size: 0.9rem; margin-bottom: 20px; flex-grow: 1; }
        .card-footer { display: flex; justify-content: space-between; align-items: center; }
        .price { font-weight: bold; font-size: 1.1rem; }
        .add-btn {
            background: #fff; color: #000; border: none;
            padding: 10px 25px; border-radius: 4px;
            font-weight: 600; cursor: pointer; transition: transform 0.1s;
        }
        .add-btn:active { transform: scale(0.95); }

        /* FOOTER */
        footer { padding: 40px 20px calc(40px + var(--safe-bottom)); border-top: 1px solid var(--border-color); }
        .footer-info { margin-bottom: 30px; }
        .footer-address { font-size: 1.2rem; margin-bottom: 10px; }
        
        /* Styled Yandex Map (Risky: CSS Filters) */
        .map-container {
            width: 100%; height: 300px;
            background: #222;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        .map-iframe {
            width: 100%; height: 100%; border: 0;
            /* Filter to mimic dark mode/grayscale */
            filter: invert(100%) hue-rotate(180deg) brightness(85%) contrast(110%);
        }

        /* CART DRAWER */
        .cart-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 1000;
            opacity: 0; pointer-events: none;
            transition: opacity 0.3s;
        }
        .cart-overlay.open { opacity: 1; pointer-events: auto; }

        .cart-drawer {
            position: fixed; top: 0; right: 0;
            width: 100%; max-width: 450px;
            height: 100%;
            background: #111;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
            border-left: 1px solid #333;
            padding-top: var(--safe-top);
        }
        .cart-overlay.open .cart-drawer { transform: translateX(0); }

        .cart-header { padding: 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .cart-close { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; padding: 10px; }
        
        .cart-items { flex-grow: 1; overflow-y: auto; padding: 20px; -webkit-overflow-scrolling: touch; }
        
        /* Cart Item Styling */
        .cart-item { display: flex; justify-content: space-between; margin-bottom: 25px; align-items: flex-start; }
        .item-info h4 { font-size: 1rem; margin-bottom: 5px; }
        .item-calc { font-size: 0.8rem; color: #777; margin-bottom: 5px; }
        .item-price { font-size: 1rem; font-weight: bold; }
        
        .item-controls { display: flex; align-items: center; gap: 15px; background: #222; border-radius: 8px; padding: 5px; }
        .qty-btn { width: 30px; height: 30px; border-radius: 4px; border: none; background: #333; color: white; font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .qty-val { font-weight: bold; font-size: 1.1rem; min-width: 20px; text-align: center; }

        /* Checkout Form */
        .checkout-area { padding: 20px; background: #1a1a1a; border-top: 1px solid #333; padding-bottom: calc(20px + var(--safe-bottom)); }
        
        .input-group { margin-bottom: 15px; position: relative; display: flex; align-items: center; background: #2a2a2a; border-radius: 8px; border: 1px solid #333; overflow: hidden; }
        
        /* Locked Prefixes logic */
        .prefix-span {
            background: #222; color: #777;
            padding: 12px 15px;
            font-size: 16px; /* No-zoom size */
            user-select: none;
            border-right: 1px solid #333;
            white-space: nowrap;
        }
        
        .checkout-input {
            width: 100%;
            background: transparent;
            border: none;
            color: white;
            padding: 12px;
            font-size: 16px; /* Prevents iOS zoom */
            outline: none;
        }
        
        .checkout-total { display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold; margin-bottom: 20px; }
        
        .btn-checkout {
            width: 100%; background: white; color: black;
            padding: 15px; border: none; border-radius: 8px;
            font-size: 1.1rem; font-weight: bold; cursor: pointer;
            position: relative; overflow: hidden;
        }

        /* Success State in Drawer */
        .success-state { padding: 20px; text-align: center; display: none; height: 100%; flex-direction: column; justify-content: center; }
        .success-icon { font-size: 4rem; margin-bottom: 20px; color: var(--accent-color); }
        .order-summary { background: #222; padding: 20px; border-radius: 8px; text-align: left; margin-top: 20px; }
        .summary-line { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px dashed #444; padding-bottom: 5px; }

        /* TOAST NOTIFICATION */
        .toast {
            position: fixed;
            bottom: 30px; left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: white; color: black;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 2000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toast.visible { transform: translateX(-50%) translateY(0); opacity: 1; }
        
    </style>
</head>
<body>

<header>
    <div class="logo">Пицца на дровах.</div>
    <div class="cart-trigger" onclick="toggleCart(true)">
        <span class="cart-text">Корзина</span>
        <div class="cart-icon-wrap">
            <svg class="cart-icon-svg" viewBox="0 0 24 24"><path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/></svg>
            <div id="cart-badge" class="cart-badge">0</div>
        </div>
    </div>
</header>

<div class="categories-wrapper">
    <div class="categories-list">
        <button class="cat-btn active">Все</button>
        <button class="cat-btn">Пицца</button>
        <button class="cat-btn">Закуски</button>
        <button class="cat-btn">Напитки</button>
        <button class="cat-btn">Соусы</button>
    </div>
</div>

<section class="hero">
    <span>Классическая Италия</span>
    <h1>В Сердце России</h1>
    <p>Дровяная печь. Испытание огнем. Тесто 72 часов ферментации. Ингредиенты, за которые нам не стыдно. Строго, честно, вкусно.</p>
</section>

<div class="grid" id="product-grid">
    <!-- Products generated by JS for simplicity, but simulating hardcoded HTML structure -->
</div>

<footer>
    <div class="footer-info">
        <div class="footer-address">г. Королев, ул. Декабристов 22</div>
        <div style="color: #666;">Ежедневно 11:00 - 23:00</div>
    </div>
    <div class="map-container">
        <!-- Yandex Map Iframe with inverted filter applied in CSS -->
        <iframe class="map-iframe" src="https://yandex.ru/map-widget/v1/?ll=37.864025%2C55.914287&z=17&pt=37.864025,55.914287,pm2rdm" allowfullscreen="true"></iframe>
    </div>
</footer>

<!-- CART DRAWER -->
<div class="cart-overlay" id="cart-overlay" onclick="if(event.target === this) toggleCart(false)">
    <div class="cart-drawer">
        <div class="cart-header">
            <h3>Ваш заказ</h3>
            <button class="cart-close" onclick="toggleCart(false)">&times;</button>
        </div>
        
        <!-- Standard Cart State -->
        <div id="cart-content" style="display:flex; flex-direction:column; height:100%; overflow:hidden;">
            <div class="cart-items" id="cart-items">
                <!-- Items go here -->
                <div style="text-align:center; color:#555; margin-top:50px;">Корзина пуста</div>
            </div>

            <div class="checkout-area" id="checkout-area">
                <div class="input-group">
                    <input type="text" class="checkout-input" id="input-name" placeholder="Ваше Имя">
                </div>
                
                <div class="input-group">
                    <span class="prefix-span">+7</span>
                    <input type="tel" class="checkout-input" id="input-phone" placeholder="900-000-00-00">
                </div>

                <div class="input-group">
                    <span class="prefix-span">г. Королёв</span>
                    <input type="text" class="checkout-input" id="input-address" placeholder="Улица, дом, кв">
                </div>

                <div class="checkout-total">
                    <span>Итого:</span>
                    <span id="cart-total">0 ₽</span>
                </div>
                
                <button class="btn-checkout" onclick="submitOrder()">
                    Оформить заказ
                </button>
            </div>
        </div>

        <!-- Success State -->
        <div id="success-state" class="success-state">
            <div class="success-icon">✓</div>
            <h2>Заказ принят!</h2>
            <p style="color:#888;">Мы уже греем печь.</p>
            
            <div class="order-summary" id="final-summary">
                <!-- Summary injected here -->
            </div>
            
            <button class="btn-checkout" style="margin-top: 20px;" onclick="toggleCart(false); resetCartUi()">
                Отлично
            </button>
        </div>

    </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast">Товар добавлен</div>

<script>
    // --- Data ---
    const products = [
        { id: 1, title: "Маргарита", desc: "Томаты пелати, моцарелла, базилик", price: 450 },
        { id: 2, title: "Пепперони", desc: "Пикантная колбаса, моцарелла, перец чили", price: 590 },
        { id: 3, title: "4 Сыра", desc: "Моцарелла, горгонзола, пармезан, чеддер", price: 620 },
        { id: 4, title: "Дьявола", desc: "Острая салями, красный лук, халапеньо", price: 580 },
        { id: 5, title: "Груша Горгонзола", desc: "Сливочный соус, груша, мед, орехи", price: 650 },
        { id: 6, title: "Ветчина и Грибы", desc: "Ветчина прошутто, шампиньоны, масло", price: 550 },
    ];

    let cart = [];

    // --- Init ---
    const grid = document.getElementById('product-grid');
    products.forEach(p => {
        const el = document.createElement('div');
        el.className = 'card';
        el.innerHTML = `
            <div>
                <h3>${p.title}</h3>
                <p>${p.desc}</p>
            </div>
            <div class="card-footer">
                <span class="price">${p.price} ₽</span>
                <button class="add-btn" onclick="addToCart(${p.id})">В корзину</button>
            </div>
        `;
        grid.appendChild(el);
    });

    // --- Logic ---

    function addToCart(id) {
        const product = products.find(p => p.id === id);
        const existing = cart.find(i => i.id === id);
        
        if (existing) {
            existing.qty++;
        } else {
            cart.push({ ...product, qty: 1 });
        }

        updateBadge();
        renderCartItems(); // Pre-render so it's ready
        showToast(`+ ${product.title}`);
    }

    function updateBadge() {
        const totalQty = cart.reduce((sum, item) => sum + item.qty, 0);
        const badge = document.getElementById('cart-badge');
        badge.innerText = totalQty;
        
        if (totalQty > 0) {
            badge.classList.add('active');
        } else {
            badge.classList.remove('active');
        }
    }

    function showToast(text) {
        const toast = document.getElementById('toast');
        toast.innerText = text;
        toast.classList.add('visible');
        
        setTimeout(() => {
            toast.classList.remove('visible');
        }, 2000);
    }

    function toggleCart(open) {
        const overlay = document.getElementById('cart-overlay');
        const body = document.body;
        
        if (open) {
            renderCartItems();
            overlay.classList.add('open');
            body.classList.add('no-scroll'); // Lock scroll
        } else {
            overlay.classList.remove('open');
            body.classList.remove('no-scroll');
        }
    }

    function changeQty(id, delta) {
        const item = cart.find(i => i.id === id);
        if (!item) return;

        item.qty += delta;
        if (item.qty <= 0) {
            cart = cart.filter(i => i.id !== id);
        }
        
        renderCartItems();
        updateBadge();
    }

    function renderCartItems() {
        const container = document.getElementById('cart-items');
        const totalEl = document.getElementById('cart-total');
        const checkoutArea = document.getElementById('checkout-area');
        
        if (cart.length === 0) {
            container.innerHTML = '<div style="text-align:center; color:#555; margin-top:50px;">Корзина пуста</div>';
            checkoutArea.style.opacity = '0.5';
            checkoutArea.style.pointerEvents = 'none';
            totalEl.innerText = '0 ₽';
            return;
        }

        checkoutArea.style.opacity = '1';
        checkoutArea.style.pointerEvents = 'auto';

        let html = '';
        let total = 0;

        cart.forEach(item => {
            const itemTotal = item.price * item.qty;
            total += itemTotal;
            
            // Logic: Show calculation only if qty > 1
            const calcHtml = item.qty > 1 
                ? `<div class="item-calc">${item.qty} x ${item.price} = ${itemTotal} ₽</div>` 
                : '';

            html += `
            <div class="cart-item">
                <div class="item-info">
                    <h4>${item.title}</h4>
                    ${calcHtml}
                    <div class="item-price">${item.qty === 1 ? item.price + ' ₽' : ''}</div>
                </div>
                <div class="item-controls">
                    <button class="qty-btn" onclick="changeQty(${item.id}, -1)">−</button>
                    <span class="qty-val">${item.qty}</span>
                    <button class="qty-btn" onclick="changeQty(${item.id}, 1)">+</button>
                </div>
            </div>
            `;
        });

        container.innerHTML = html;
        totalEl.innerText = total + ' ₽';
    }

    function submitOrder() {
        const name = document.getElementById('input-name').value;
        const phone = document.getElementById('input-phone').value;
        const address = document.getElementById('input-address').value;

        if (!name || !phone || !address) {
            alert('Пожалуйста, заполните все поля');
            return;
        }

        // Simulate API call animation
        const btn = document.querySelector('.btn-checkout');
        const originalText = btn.innerText;
        btn.innerText = 'Отправка...';
        btn.style.opacity = '0.7';

        setTimeout(() => {
            // Restore btn
            btn.innerText = originalText;
            btn.style.opacity = '1';

            // Switch to success view
            document.getElementById('cart-content').style.display = 'none';
            const successDiv = document.getElementById('success-state');
            successDiv.style.display = 'flex';

            // Generate Summary
            const total = cart.reduce((sum, i) => sum + (i.price * i.qty), 0);
            let summaryHtml = `
                <div class="summary-line"><span>Имя:</span> <span>${name}</span></div>
                <div class="summary-line"><span>Тел:</span> <span>+7 ${phone}</span></div>
                <div class="summary-line"><span>Адрес:</span> <span>г. Королёв, ${address}</span></div>
                <br>
            `;
            cart.forEach(i => {
                summaryHtml += `<div class="summary-line" style="border:none; margin:0; color:#aaa; font-size:0.9em;">
                    <span>${i.title} x${i.qty}</span>
                </div>`;
            });
            summaryHtml += `<div style="margin-top:10px; font-weight:bold; text-align:right; font-size:1.2em;">Итого: ${total} ₽</div>`;
            
            document.getElementById('final-summary').innerHTML = summaryHtml;

            // Clear logic
            cart = [];
            updateBadge();
        }, 1500);
    }

    function resetCartUi() {
        // Reset UI back to form for next time (after closing success)
        setTimeout(() => {
            document.getElementById('cart-content').style.display = 'flex';
            document.getElementById('success-state').style.display = 'none';
            document.getElementById('input-name').value = '';
            document.getElementById('input-phone').value = '';
            document.getElementById('input-address').value = '';
            renderCartItems();
        }, 500);
    }

</script>

</body>
</html>
