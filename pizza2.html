<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ü–∏—Ü—Ü–µ—Ä–∏—è ¬´–ö—Ä—É–≥ –∏ –¢–µ—Å—Ç–æ¬ª ‚Äî –∫–∞—Ç–∞–ª–æ–≥</title>
  <meta name="description" content="–ö–∞—Ç–∞–ª–æ–≥ –∏ –∑–∞–∫–∞–∑ –ø–∏—Ü—Ü—ã. –î–µ–º–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞: —Ñ–∏–ª—å—Ç—Ä—ã, –∫–æ—Ä–∑–∏–Ω–∞, –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ." />

  <style>
    :root{
      --bg:#0f1115;
      --panel:#151925;
      --panel2:#121622;
      --text:#e9ecf1;
      --muted:#a8b0c0;
      --line:#252b3b;
      --accent:#e94b4b;
      --accent2:#f7b24a;
      --ok:#46d18f;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --radius2:22px;
      --max:1100px;
      --tap:48px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family:var(--sans);
      background: radial-gradient(1200px 600px at 20% -10%, rgba(233,75,75,.18), transparent 60%),
                  radial-gradient(900px 500px at 100% 0%, rgba(247,178,74,.12), transparent 55%),
                  var(--bg);
      color:var(--text);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    a{ color:inherit; text-decoration:none; }
    button, input, select{ font:inherit; }
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0;
    }

    /* Layout */
    .wrap{
      max-width:var(--max);
      margin:0 auto;
      padding:16px;
      padding-bottom: calc(16px + env(safe-area-inset-bottom));
    }

    header{
      position: sticky;
      top:0;
      z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(15,17,21,.92), rgba(15,17,21,.70));
      border-bottom: 1px solid rgba(255,255,255,.06);
    }

    .topbar{
      max-width:var(--max);
      margin:0 auto;
      padding: 12px 16px;
      display:flex;
      align-items:center;
      gap:12px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 180px;
    }
    .logo{
      width:40px; height:40px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(233,75,75,.95), rgba(247,178,74,.92));
      box-shadow: var(--shadow);
      display:grid;
      place-items:center;
      font-weight:800;
      letter-spacing:.5px;
      color:#0b0d12;
      flex:0 0 auto;
    }
    .brand h1{
      margin:0;
      font-size:16px;
      line-height:1.1;
      font-weight:800;
    }
    .brand p{
      margin:2px 0 0 0;
      font-size:12px;
      color:var(--muted);
    }

    .search{
      flex:1;
      display:flex;
      align-items:center;
      gap:10px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 999px;
      padding: 10px 12px;
      min-height: var(--tap);
    }
    .search svg{ opacity:.8; }
    .search input{
      width:100%;
      background:transparent;
      border:none;
      outline:none;
      color:var(--text);
      font-size:14px;
    }
    .search input::placeholder{ color: rgba(168,176,192,.9); }

    .cart-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 10px 14px;
      min-height: var(--tap);
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .cart-btn:active{ transform: scale(.98); }
    .badge{
      min-width: 22px;
      height: 22px;
      padding: 0 6px;
      border-radius: 999px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-size: 12px;
      font-weight: 700;
      color:#0b0d12;
      background: linear-gradient(135deg, rgba(233,75,75,.95), rgba(247,178,74,.92));
    }

    /* Filters */
    .filters{
      margin-top: 14px;
      display:grid;
      gap:10px;
    }
    .filter-row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .seg{
      display:flex;
      gap:8px;
      overflow:auto;
      padding-bottom: 2px;
      scrollbar-width: none;
    }
    .seg::-webkit-scrollbar{ display:none; }
    .chip{
      flex:0 0 auto;
      padding: 10px 12px;
      min-height: 40px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: var(--text);
      cursor:pointer;
      white-space:nowrap;
      transition: background .15s ease, border-color .15s ease;
    }
    .chip[aria-pressed="true"]{
      border-color: rgba(233,75,75,.55);
      background: rgba(233,75,75,.14);
    }

    .control{
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 10px 12px;
      min-height: var(--tap);
      display:flex;
      align-items:center;
      gap:10px;
    }
    .control label{
      color: var(--muted);
      font-size:12px;
      min-width: 72px;
    }
    .control select{
      width:100%;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 14px;
    }

    /* Grid */
    .meta{
      margin-top: 16px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
    }
    .meta h2{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .meta .hint{
      margin:0;
      color: var(--muted);
      font-size: 12px;
    }

    .grid{
      margin-top: 12px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius2);
      overflow:hidden;
      box-shadow: 0 8px 26px rgba(0,0,0,.22);
      display:grid;
      grid-template-columns: 116px 1fr;
      min-height: 140px;
    }
    .thumb{
      background:
        radial-gradient(70px 60px at 55% 45%, rgba(247,178,74,.25), transparent 60%),
        radial-gradient(80px 60px at 45% 55%, rgba(233,75,75,.22), transparent 62%),
        linear-gradient(135deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
      border-right: 1px solid rgba(255,255,255,.06);
      display:grid;
      place-items:center;
      position:relative;
    }
    .thumb .emoji{
      font-size: 44px;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.35));
    }
    .thumb .tag{
      position:absolute;
      left:10px; top:10px;
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.28);
      border: 1px solid rgba(255,255,255,.10);
      color: rgba(233,236,241,.92);
    }

    .content{
      padding: 12px 12px 12px 12px;
      display:flex;
      flex-direction:column;
      gap: 8px;
    }
    .title{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .title h3{
      margin:0;
      font-size: 16px;
      line-height:1.2;
      font-weight: 800;
    }
    .price{
      font-weight: 900;
      font-size: 15px;
      color: var(--text);
      white-space: nowrap;
    }
    .desc{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .row{
      margin-top:auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .pill{
      display:inline-flex;
      gap: 8px;
      align-items:center;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      color: rgba(233,236,241,.92);
      font-size: 12px;
      white-space: nowrap;
    }
    .pill .kcal{
      font-family: var(--mono);
      opacity:.85;
    }

    .actions{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .btn{
      cursor:pointer;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--text);
      border-radius: 14px;
      min-height: var(--tap);
      padding: 10px 12px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      transition: background .15s ease, border-color .15s ease, transform .08s ease;
      user-select:none;
    }
    .btn:active{ transform: scale(.98); }

    .btn.primary{
      border-color: rgba(233,75,75,.45);
      background: rgba(233,75,75,.16);
    }

    .qty{
      display:flex;
      align-items:center;
      border:1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      overflow:hidden;
      background: rgba(255,255,255,.03);
      min-height: var(--tap);
    }
    .qty button{
      width: var(--tap);
      height: var(--tap);
      border:none;
      background: transparent;
      color: var(--text);
      cursor:pointer;
    }
    .qty span{
      min-width: 30px;
      text-align:center;
      font-weight: 800;
      font-family: var(--mono);
      padding: 0 6px;
    }

    /* Drawer (Cart) */
    .overlay{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.55);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease;
      z-index: 80;
    }
    .overlay.show{
      opacity:1;
      pointer-events:auto;
    }
    .drawer{
      position: fixed;
      right: 0;
      top: 0;
      height: 100%;
      width: min(420px, 92vw);
      background: linear-gradient(180deg, rgba(21,25,37,.98), rgba(18,22,34,.98));
      border-left: 1px solid rgba(255,255,255,.08);
      box-shadow: -20px 0 60px rgba(0,0,0,.35);
      transform: translateX(100%);
      transition: transform .22s ease;
      z-index: 90;
      display:flex;
      flex-direction:column;
      padding-bottom: env(safe-area-inset-bottom);
    }
    .drawer.show{ transform: translateX(0); }

    .drawer header{
      position: static;
      backdrop-filter: none;
      background: transparent;
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .drawer .head{
      padding: 14px 14px 10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }
    .drawer .head h3{ margin:0; font-size: 16px; }
    .close{
      width: var(--tap);
      height: var(--tap);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
    }

    .cart{
      padding: 12px 14px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap: 10px;
      flex:1;
    }
    .cart-item{
      display:grid;
      grid-template-columns: 44px 1fr auto;
      gap: 10px;
      align-items:center;
      padding: 10px;
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 16px;
      background: rgba(255,255,255,.03);
    }
    .cart-item .mini{
      width:44px; height:44px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      background:
        radial-gradient(22px 22px at 50% 45%, rgba(247,178,74,.22), transparent 60%),
        radial-gradient(26px 26px at 50% 55%, rgba(233,75,75,.20), transparent 60%),
        rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.08);
      font-size: 22px;
    }
    .cart-item .name{
      display:flex;
      flex-direction:column;
      gap: 2px;
      min-width: 0;
    }
    .cart-item .name strong{
      font-size: 13px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .cart-item .name small{
      color: var(--muted);
      font-size: 12px;
      font-family: var(--mono);
    }
    .cart-item .right{
      display:flex;
      align-items:center;
      gap: 8px;
    }
    .trash{
      width: 42px;
      height: 42px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
    }

    .summary{
      border-top: 1px solid rgba(255,255,255,.08);
      padding: 12px 14px 14px 14px;
      display:flex;
      flex-direction:column;
      gap: 10px;
      background: rgba(0,0,0,.12);
    }
    .line{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      font-size: 13px;
      color: rgba(233,236,241,.92);
    }
    .line span{ color: var(--muted); }
    .line strong{ font-size: 15px; }
    .checkout{
      display:flex;
      gap:10px;
    }
    .checkout .btn{ width:100%; }
    .btn.ok{
      border-color: rgba(70,209,143,.45);
      background: rgba(70,209,143,.14);
    }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%) translateY(20px);
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 999px;
      z-index: 120;
      font-size: 13px;
      backdrop-filter: blur(10px);
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(0);
    }

    /* Desktop */
    @media (min-width: 720px){
      .wrap{ padding: 20px; }
      .grid{
        grid-template-columns: repeat(2, 1fr);
        gap: 14px;
      }
      .card{
        grid-template-columns: 140px 1fr;
        min-height: 150px;
      }
      .brand h1{ font-size: 17px; }
    }
    @media (min-width: 980px){
      .grid{ grid-template-columns: repeat(3, 1fr); }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; scroll-behavior:auto !important; }
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar" role="banner">
      <div class="brand" aria-label="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∏—Ü—Ü–µ—Ä–∏–∏">
        <div class="logo" aria-hidden="true">œÄ</div>
        <div>
          <h1>–ö—Ä—É–≥ –∏ –¢–µ—Å—Ç–æ</h1>
          <p>–ö–∞—Ç–∞–ª–æ–≥ ¬∑ —Å–∞–º–æ–≤—ã–≤–æ–∑/–¥–æ—Å—Ç–∞–≤–∫–∞ (–¥–µ–º–æ)</p>
        </div>
      </div>

      <div class="search" role="search" aria-label="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="2"/>
          <path d="M16 16l5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input id="q" type="search" inputmode="search" placeholder="–ü–µ–ø–ø–µ—Ä–æ–Ω–∏, —Å—ã—Ä, –≥—Ä–∏–±—ã‚Ä¶" autocomplete="off" />
      </div>

      <button class="cart-btn" id="openCart" aria-label="–û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É">
        <span aria-hidden="true">üß∫</span>
        <span class="sr-only">–ö–æ—Ä–∑–∏–Ω–∞</span>
        <span class="badge" id="cartCount">0</span>
      </button>
    </div>
  </header>

  <main class="wrap" id="main">
    <section class="filters" aria-label="–§–∏–ª—å—Ç—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–∞">
      <div class="seg" id="tags">
        <!-- chips inserted by JS -->
      </div>

      <div class="filter-row">
        <div class="control">
          <label for="size">–†–∞–∑–º–µ—Ä</label>
          <select id="size">
            <option value="all">–õ—é–±–æ–π</option>
            <option value="25">25 —Å–º</option>
            <option value="30">30 —Å–º</option>
            <option value="35">35 —Å–º</option>
          </select>
        </div>
        <div class="control">
          <label for="sort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
          <select id="sort">
            <option value="popular">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</option>
            <option value="price_asc">–¶–µ–Ω–∞ ‚Üë</option>
            <option value="price_desc">–¶–µ–Ω–∞ ‚Üì</option>
            <option value="name">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
          </select>
        </div>
      </div>
    </section>

    <section class="meta" aria-label="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–∞—Ç–∞–ª–æ–≥–∞">
      <div>
        <h2>–ü–∏—Ü—Ü–∞</h2>
        <p class="hint" id="resultHint">‚Äî</p>
      </div>
      <p class="hint">–ù–∞–∂–º–∏ ‚Äú+‚Äù –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</p>
    </section>

    <section class="grid" id="grid" aria-label="–°–ø–∏—Å–æ–∫ –ø–∏—Ü—Ü—ã">
      <!-- cards inserted by JS -->
    </section>

    <section style="margin-top:18px; color: var(--muted); font-size:12px; line-height:1.45;">
      <p style="margin:0;">
        –î–µ–º–æ: –∫–æ—Ä–∑–∏–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. ‚Äú–û—Ñ–æ—Ä–º–∏—Ç—å‚Äù —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø–∏—Å—å–º–æ —á–µ—Ä–µ–∑ <span style="font-family:var(--mono)">mailto:</span> (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ API).
      </p>
    </section>
  </main>

  <!-- Cart Drawer -->
  <div class="overlay" id="overlay" aria-hidden="true"></div>
  <aside class="drawer" id="drawer" aria-label="–ö–æ—Ä–∑–∏–Ω–∞" aria-hidden="true">
    <header>
      <div class="head">
        <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
        <button class="close" id="closeCart" aria-label="–ó–∞–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É">‚úï</button>
      </div>
    </header>

    <div class="cart" id="cartList" aria-label="–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã">
      <!-- items inserted by JS -->
    </div>

    <div class="summary" aria-label="–ò—Ç–æ–≥–æ">
      <div class="line"><span>–¢–æ–≤–∞—Ä—ã</span><strong id="sumItems">0</strong></div>
      <div class="line"><span>–°—É–º–º–∞</span><strong id="sumPrice">0 ‚ÇΩ</strong></div>
      <div class="checkout">
        <button class="btn" id="clearCart" aria-label="–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <a class="btn ok" id="checkout" href="#" aria-label="–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑">–û—Ñ–æ—Ä–º–∏—Ç—å</a>
      </div>
    </div>
  </aside>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ===== Demo Data =====
    const PIZZAS = [
      { id:"pepperoni", name:"–ü–µ–ø–ø–µ—Ä–æ–Ω–∏", emoji:"üçï", tags:["–º—è—Å–Ω–∞—è","–ø–æ–ø—É–ª—è—Ä–Ω–æ–µ"], desc:"–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –ø–µ–ø–ø–µ—Ä–æ–Ω–∏.", kcal: 280,
        sizes:{ "25": 399, "30": 549, "35": 699 } },
      { id:"margherita", name:"–ú–∞—Ä–≥–∞—Ä–∏—Ç–∞", emoji:"üçï", tags:["–≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∞—è","–∫–ª–∞—Å—Å–∏–∫–∞"], desc:"–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –±–∞–∑–∏–ª–∏–∫.", kcal: 240,
        sizes:{ "25": 349, "30": 489, "35": 629 } },
      { id:"four_cheese", name:"–ß–µ—Ç—ã—Ä–µ —Å—ã—Ä–∞", emoji:"üßÄ", tags:["–≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∞—è","—Å–ª–∏–≤–æ—á–Ω–∞—è"], desc:"–ú–æ—Ü–∞—Ä–µ–ª–ª–∞, –¥–æ—Ä–±–ª—é, –ø–∞—Ä–º–µ–∑–∞–Ω, —á–µ–¥–¥–µ—Ä.", kcal: 320,
        sizes:{ "25": 429, "30": 589, "35": 749 } },
      { id:"mushrooms", name:"–ì—Ä–∏–±–Ω–∞—è", emoji:"üçÑ", tags:["–≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∞—è","—Å–ª–∏–≤–æ—á–Ω–∞—è"], desc:"–°–ª–∏–≤–æ—á–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, —à–∞–º–ø–∏–Ω—å–æ–Ω—ã.", kcal: 260,
        sizes:{ "25": 389, "30": 529, "35": 679 } },
      { id:"bbq_chicken", name:"–¶—ã–ø–ª—ë–Ω–æ–∫ BBQ", emoji:"üçó", tags:["–º—è—Å–Ω–∞—è"], desc:"BBQ —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, —Ü—ã–ø–ª—ë–Ω–æ–∫, –ª—É–∫.", kcal: 300,
        sizes:{ "25": 429, "30": 599, "35": 769 } },
      { id:"hawaii", name:"–ì–∞–≤–∞–π—Å–∫–∞—è", emoji:"üçç", tags:["–º—è—Å–Ω–∞—è","—Å–ø–æ—Ä–Ω–æ"], desc:"–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, –≤–µ—Ç—á–∏–Ω–∞, –∞–Ω–∞–Ω–∞—Å.", kcal: 290,
        sizes:{ "25": 409, "30": 569, "35": 729 } },
      { id:"vegan", name:"–û–≤–æ—â–Ω–∞—è (–≤–µ–≥–∞–Ω)", emoji:"ü•¶", tags:["–≤–µ–≥–∞–Ω","–ª–µ–≥–∫–∞—è"], desc:"–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –æ–≤–æ—â–∏, –∑–µ–ª–µ–Ω—å (–±–µ–∑ —Å—ã—Ä–∞).", kcal: 200,
        sizes:{ "25": 329, "30": 469, "35": 609 } },
      { id:"spicy", name:"–û—Å—Ç—Ä–∞—è —Å–∞–ª—è–º–∏", emoji:"üå∂Ô∏è", tags:["–º—è—Å–Ω–∞—è","–æ—Å—Ç—Ä–∞—è"], desc:"–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ—É—Å, –º–æ—Ü–∞—Ä–µ–ª–ª–∞, —Å–∞–ª—è–º–∏, —Ö–∞–ª–∞–ø–µ–Ω—å–æ.", kcal: 310,
        sizes:{ "25": 419, "30": 579, "35": 739 } },
    ];

    const ALL_TAGS = Array.from(new Set(PIZZAS.flatMap(p => p.tags))).sort((a,b)=>a.localeCompare(b,'ru'));

    // ===== State =====
    const state = {
      q: "",
      tag: "all",
      size: "30",
      sort: "popular",
      cart: new Map(), // key: `${id}:${size}` -> {id, size, qty}
    };

    // ===== Helpers =====
    const $ = (sel) => document.querySelector(sel);
    const money = (n) => `${n.toLocaleString('ru-RU')} ‚ÇΩ`;

    function showToast(text){
      const t = $("#toast");
      t.textContent = text;
      t.classList.add("show");
      clearTimeout(showToast._timer);
      showToast._timer = setTimeout(()=> t.classList.remove("show"), 1200);
    }

    function cartKey(id, size){ return `${id}:${size}`; }

    function getPizza(id){ return PIZZAS.find(p => p.id === id); }

    function addToCart(id, size, delta=1){
      const key = cartKey(id, size);
      const existing = state.cart.get(key) || { id, size, qty: 0 };
      existing.qty = Math.max(0, existing.qty + delta);
      if(existing.qty === 0) state.cart.delete(key);
      else state.cart.set(key, existing);
      renderCart();
      renderGrid(); // update qty controls in cards
    }

    function setQty(id, size, qty){
      const key = cartKey(id, size);
      if(qty <= 0) state.cart.delete(key);
      else state.cart.set(key, { id, size, qty });
      renderCart();
      renderGrid();
    }

    function getQty(id, size){
      const key = cartKey(id, size);
      return state.cart.get(key)?.qty || 0;
    }

    function cartTotals(){
      let items = 0;
      let sum = 0;
      for(const {id, size, qty} of state.cart.values()){
        const p = getPizza(id);
        const price = p.sizes[size];
        items += qty;
        sum += price * qty;
      }
      return { items, sum };
    }

    function filtered(){
      const q = state.q.trim().toLowerCase();
      const tag = state.tag;

      let list = PIZZAS.filter(p => {
        const hay = (p.name + " " + p.desc + " " + p.tags.join(" ")).toLowerCase();
        const okQ = !q || hay.includes(q);
        const okTag = (tag === "all") || p.tags.includes(tag);
        return okQ && okTag;
      });

      // sort
      if(state.sort === "price_asc"){
        list.sort((a,b)=> a.sizes[state.size] - b.sizes[state.size]);
      } else if(state.sort === "price_desc"){
        list.sort((a,b)=> b.sizes[state.size] - a.sizes[state.size]);
      } else if(state.sort === "name"){
        list.sort((a,b)=> a.name.localeCompare(b.name,'ru'));
      } else {
        // popular: stable order (as in data)
        // keep as is
      }

      return list;
    }

    // ===== UI Render =====
    function renderTags(){
      const host = $("#tags");
      host.innerHTML = "";

      const mk = (label, value) => {
        const btn = document.createElement("button");
        btn.className = "chip";
        btn.type = "button";
        btn.textContent = label;
        btn.setAttribute("aria-pressed", String(state.tag === value));
        btn.addEventListener("click", ()=>{
          state.tag = value;
          renderTags();
          renderGrid();
        });
        return btn;
      };

      host.appendChild(mk("–í—Å–µ", "all"));
      ALL_TAGS.forEach(t => host.appendChild(mk(t[0].toUpperCase()+t.slice(1), t)));
    }

    function cardHTML(p){
      const size = state.size;
      const price = p.sizes[size];
      const qty = getQty(p.id, size);

      const tag = p.tags.includes("–ø–æ–ø—É–ª—è—Ä–Ω–æ–µ") ? "—Ö–∏—Ç" : (p.tags.includes("–æ—Å—Ç—Ä–∞—è") ? "–æ—Å—Ç—Ä–∞—è" : (p.tags.includes("–≤–µ–≥–∞–Ω") ? "–≤–µ–≥–∞–Ω" : p.tags[0]));
      const tagText = tag ? tag : "–ø–∏—Ü—Ü–∞";

      const qtyUI = qty > 0
        ? `
          <div class="qty" aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤ –∫–æ—Ä–∑–∏–Ω–µ">
            <button data-act="dec" data-id="${p.id}" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å">‚àí</button>
            <span aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">${qty}</span>
            <button data-act="inc" data-id="${p.id}" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
          </div>
        `
        : `
          <button class="btn primary" data-act="add" data-id="${p.id}" aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É">
            + –î–æ–±–∞–≤–∏—Ç—å
          </button>
        `;

      return `
        <article class="card" data-id="${p.id}">
          <div class="thumb">
            <div class="tag">${escapeHTML(tagText)}</div>
            <div class="emoji" aria-hidden="true">${p.emoji}</div>
          </div>
          <div class="content">
            <div class="title">
              <h3>${escapeHTML(p.name)}</h3>
              <div class="price">${money(price)}</div>
            </div>
            <p class="desc">${escapeHTML(p.desc)}</p>
            <div class="row">
              <div class="pill" title="–û—Ü–µ–Ω–∫–∞ –∫–∞–ª–æ—Ä–∏–π–Ω–æ—Å—Ç–∏">
                <span>–†–∞–∑–º–µ—Ä: <strong>${size} —Å–º</strong></span>
                <span class="kcal">${p.kcal} –∫–∫–∞–ª</span>
              </div>
              <div class="actions">
                ${qtyUI}
              </div>
            </div>
          </div>
        </article>
      `;
    }

    function renderGrid(){
      const list = filtered();
      const host = $("#grid");
      host.innerHTML = list.map(cardHTML).join("");

      $("#resultHint").textContent = `${list.length} –ø–æ–∑–∏—Ü–∏–π ¬∑ —Ä–∞–∑–º–µ—Ä ${state.size} —Å–º`;

      // attach events
      host.querySelectorAll("[data-act]").forEach(el=>{
        el.addEventListener("click", ()=>{
          const act = el.getAttribute("data-act");
          const id = el.getAttribute("data-id");
          const size = state.size;

          if(act === "add" || act === "inc"){
            addToCart(id, size, +1);
            showToast("–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É");
          } else if(act === "dec"){
            addToCart(id, size, -1);
          }
        });
      });
    }

    function renderCart(){
      const host = $("#cartList");
      const { items, sum } = cartTotals();
      $("#cartCount").textContent = String(items);
      $("#sumItems").textContent = String(items);
      $("#sumPrice").textContent = money(sum);

      if(items === 0){
        host.innerHTML = `
          <div style="padding:14px; color: var(--muted); border:1px dashed rgba(255,255,255,.12); border-radius: 16px;">
            –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è. –î–æ–±–∞–≤—å –ø–∞—Ä—É –∫—Ä—É–≥–æ–≤ —Å—á–∞—Å—Ç—å—è üçï
          </div>
        `;
        $("#checkout").setAttribute("href", "#");
        $("#checkout").setAttribute("aria-disabled", "true");
        $("#checkout").style.opacity = "0.55";
        return;
      }

      $("#checkout").removeAttribute("aria-disabled");
      $("#checkout").style.opacity = "1";

      const rows = Array.from(state.cart.values()).map(({id, size, qty})=>{
        const p = getPizza(id);
        const price = p.sizes[size];
        return `
          <div class="cart-item" data-key="${cartKey(id,size)}">
            <div class="mini" aria-hidden="true">${p.emoji}</div>
            <div class="name">
              <strong>${escapeHTML(p.name)} ¬∑ ${size} —Å–º</strong>
              <small>${money(price)} √ó ${qty} = ${money(price*qty)}</small>
            </div>
            <div class="right">
              <div class="qty" aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
                <button data-cact="dec" data-id="${id}" data-size="${size}" aria-label="–£–º–µ–Ω—å—à–∏—Ç—å">‚àí</button>
                <span aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">${qty}</span>
                <button data-cact="inc" data-id="${id}" data-size="${size}" aria-label="–£–≤–µ–ª–∏—á–∏—Ç—å">+</button>
              </div>
              <button class="trash" data-cact="del" data-id="${id}" data-size="${size}" aria-label="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
            </div>
          </div>
        `;
      });

      host.innerHTML = rows.join("");

      host.querySelectorAll("[data-cact]").forEach(el=>{
        el.addEventListener("click", ()=>{
          const act = el.getAttribute("data-cact");
          const id = el.getAttribute("data-id");
          const size = el.getAttribute("data-size");
          if(act === "inc") addToCart(id, size, +1);
          if(act === "dec") addToCart(id, size, -1);
          if(act === "del") setQty(id, size, 0);
        });
      });

      // Build checkout mailto (demo)
      const subject = encodeURIComponent("–ó–∞–∫–∞–∑ –ø–∏—Ü—Ü—ã (–¥–µ–º–æ)");
      const lines = [];
      lines.push("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!");
      lines.push("");
      lines.push("–•–æ—á—É –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑:");
      for(const {id, size, qty} of state.cart.values()){
        const p = getPizza(id);
        const price = p.sizes[size];
        lines.push(`- ${p.name}, ${size} —Å–º ‚Äî ${qty} —à—Ç (–ø–æ ${price} ‚ÇΩ)`);
      }
      lines.push("");
      lines.push(`–ò—Ç–æ–≥–æ: ${sum} ‚ÇΩ`);
      lines.push("");
      lines.push("–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ / —Ç–µ–ª–µ—Ñ–æ–Ω:");
      lines.push("‚Äî");
      const body = encodeURIComponent(lines.join("\n"));

      // Replace this email with your real orders address
      $("#checkout").setAttribute("href", `mailto:orders@example.com?subject=${subject}&body=${body}`);
    }

    function escapeHTML(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===== Drawer controls =====
    const overlay = $("#overlay");
    const drawer  = $("#drawer");

    function openCart(){
      overlay.classList.add("show");
      drawer.classList.add("show");
      overlay.setAttribute("aria-hidden", "false");
      drawer.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }
    function closeCart(){
      overlay.classList.remove("show");
      drawer.classList.remove("show");
      overlay.setAttribute("aria-hidden", "true");
      drawer.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }

    $("#openCart").addEventListener("click", openCart);
    $("#closeCart").addEventListener("click", closeCart);
    overlay.addEventListener("click", closeCart);
    window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeCart(); });

    $("#clearCart").addEventListener("click", ()=>{
      state.cart.clear();
      renderCart();
      renderGrid();
      showToast("–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞");
    });

    // ===== Filters/events =====
    $("#q").addEventListener("input", (e)=>{
      state.q = e.target.value;
      renderGrid();
    });

    $("#size").addEventListener("change", (e)=>{
      state.size = e.target.value;
      renderGrid();
    });

    $("#sort").addEventListener("change", (e)=>{
      state.sort = e.target.value;
      renderGrid();
    });

    // Default size select
    $("#size").value = state.size;

    // ===== Init =====
    renderTags();
    renderGrid();
    renderCart();
  </script>
</body>
</html>
